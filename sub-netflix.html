<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="https://fonts.googleapis.com/css?family=Fira+Sans&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <title>Tracker App</title>
</head>

<body>
    <!-- HEADER -->
    <div class="header_image">
        <div class="header_block">
        </div>
        <div class="header_text">
            <h1 id="header">TRACKER APP</h1>
        </div>
    </div>
    <div class="section">
        <h4 class="sectionTitle">Netflix Usage Records</h4>
    </div>
    <div id="sectionID">
        <p class="section" ></p>
    </div>

    <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-firestore.js"></script>
    <script src="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.js"></script>
    <script src="js/firebase_setup.js"></script>
    <script src="js/app.js"></script>
    <script>

        let myTime = localStorage.getItem('time');
        let myDate = localStorage.getItem('date');
        let mySub = localStorage.getItem('subName');
        let myHistory = ""
        
        function timeHistory() {
            myHistory += document.write(mySub + " " + myDate + " " + myTime + " seconds");
        }

        function getLogs(userID) {
            db.collection("users").doc(`${userID}`).collection("netflix").get().then(function (snapshot) {
                snapshot.forEach(function(doc) {
                    displayUsage(doc.id, doc.data());
                    console.log(doc.id, " => ", doc.data());
                });
            })
            .catch(function(error) {
                console.log("Error getting documents: ", error);
            });
        }

        function displayUsage(id, data) {
            console.log(id, data, typeof(data));
            let log = document.createElement("p");
            log.innerHTML = id + ": " + data["time"];
            document.getElementById("sectionID").appendChild(log);
            // document.getElementById("sectionID").innerHTML = id + ": " + data["time"];
        }

        
        // function getTime(userID) {
        //     let ref = db.doc(`users/${userID}`).get().then(function (doc) {
        //         let user = doc.data();
        //         Promise.all([user]).then(function () {
        //             // document.getElementById("sectionID").innerHTML = myDate + " " + myTime + " seconds"
        //         })
        //     })
        // }

        let tempuserID = localStorage.getItem('userID');
        // Promise.all([tempuserID]).then(function () {
        //     getTime(tempuserID);
        //     getLogs(tempuserID);
        // })

        // timeHistory();
        getLogs(tempuserID);

    </script>
</body>

</html>